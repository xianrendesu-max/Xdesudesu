<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X Viewer (Nitter Edition)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #000; color: #e7e9ea; }
        .border-gray { border-color: #2f3336; }
        .hover-bg:hover { background-color: rgba(231, 233, 234, 0.1); }
    </style>
</head>
<body class="flex justify-center">

    <nav class="hidden md:flex flex-col w-64 h-screen sticky top-0 p-4 border-r border-gray">
        <div class="text-3xl mb-8 px-4"><i class="fa-brands fa-x-twitter"></i></div>
        <div class="space-y-4">
            <div class="flex items-center text-xl p-3 rounded-full hover-bg cursor-pointer"><i class="fa-solid fa-house mr-4"></i> ホーム</div>
            <div class="flex items-center text-xl p-3 rounded-full hover-bg cursor-pointer"><i class="fa-solid fa-magnifying-glass mr-4"></i> 話題を検索</div>
            <div class="flex items-center text-xl p-3 rounded-full hover-bg cursor-pointer"><i class="fa-solid fa-user mr-4"></i> プロフィール</div>
        </div>
    </nav>

    <main class="w-full max-w-[600px] border-r border-gray min-h-screen">
        <div class="sticky top-0 bg-black/80 backdrop-blur-md p-4 border-b border-gray">
            <h2 class="text-xl font-bold">ホーム</h2>
        </div>

        <div class="p-4 border-b border-gray">
            <div class="flex gap-2">
                <input id="searchInput" type="text" placeholder="ユーザー名を入力 (例: elonmusk)" class="bg-transparent border border-gray rounded-full px-4 py-2 w-full focus:outline-none focus:border-[#1d9bf0]">
                <button onclick="loadTweets('user')" class="bg-[#1d9bf0] text-white px-4 py-2 rounded-full font-bold">表示</button>
                <button onclick="loadTweets('search')" class="bg-white text-black px-4 py-2 rounded-full font-bold">検索</button>
            </div>
        </div>

        <div id="timeline">
            <div class="p-10 text-center text-gray-500">ユーザー名を入力して表示してください</div>
        </div>
    </main>

    <aside class="hidden lg:block w-80 h-screen sticky top-0 p-4">
        <div class="bg-[#16181c] rounded-2xl p-4">
            <h2 class="text-xl font-bold mb-4">いまどうしてる？</h2>
            <div class="text-[#71767b] text-sm">Nitter APIを利用してデータを取得中</div>
        </div>
    </aside>

    <script>
        async function loadTweets(type) {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            const timeline = document.getElementById('timeline');
            timeline.innerHTML = '<div class="p-10 text-center"><i class="fas fa-circle-notch animate-spin"></i> 読み込み中...</div>';

            try {
                const response = await fetch(`http://localhost:8000/api/tweets?q=${encodeURIComponent(query)}&type=${type}`);
                const result = await response.json();

                timeline.innerHTML = '';
                result.data.forEach(tweet => {
                    const tweetHtml = `
                        <div class="p-4 border-b border-gray hover-bg cursor-pointer transition">
                            <div class="flex gap-3">
                                <div class="w-12 h-12 bg-gray-700 rounded-full flex-shrink-0"></div>
                                <div class="flex-1">
                                    <div class="flex items-center gap-1">
                                        <span class="font-bold hover:underline">${tweet.author}</span>
                                        <span class="text-[#71767b]">${tweet.published}</span>
                                    </div>
                                    <div class="mt-1 text-[15px] leading-normal">${tweet.content}</div>
                                    ${tweet.image ? `<img src="${tweet.image}" class="mt-3 rounded-2xl border border-gray max-h-80 w-auto">` : ''}
                                    <div class="flex justify-between mt-3 text-[#71767b] max-w-md">
                                        <span><i class="far fa-comment"></i></span>
                                        <span><i class="fas fa-retweet"></i></span>
                                        <span><i class="far fa-heart"></i></span>
                                        <span><i class="far fa-bookmark"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    timeline.innerHTML += tweetHtml;
                });
            } catch (err) {
                timeline.innerHTML = `<div class="p-10 text-center text-red-500">取得エラー: インスタンスがダウンしているか、存在しないユーザーです。</div>`;
            }
        }
    </script>
</body>
</html>
