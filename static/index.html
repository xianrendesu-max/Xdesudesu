<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>X Viewer (Nitter Edition)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #000; color: #e7e9ea; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .x-border { border-color: #2f3336; }
        .x-sidebar-item:hover { background-color: rgba(231, 233, 234, 0.1); transition: 0.2s; }
        .x-blue { color: #1d9bf0; }
        .x-bg-blue { background-color: #1d9bf0; }
        input::placeholder { color: #71767b; }
    </style>
</head>
<body class="flex justify-center min-h-screen">

    <header class="hidden md:flex flex-col w-64 h-screen sticky top-0 border-r x-border p-2">
        <div class="p-3 text-3xl"><i class="fa-brands fa-x-twitter"></i></div>
        <nav class="flex-1 space-y-1">
            <div class="x-sidebar-item flex items-center text-xl p-3 rounded-full cursor-pointer w-fit pr-6 font-bold"><i class="fa-solid fa-house mr-4"></i>ホーム</div>
            <div class="x-sidebar-item flex items-center text-xl p-3 rounded-full cursor-pointer w-fit pr-6"><i class="fa-solid fa-magnifying-glass mr-4"></i>話題を検索</div>
            <div class="x-sidebar-item flex items-center text-xl p-3 rounded-full cursor-pointer w-fit pr-6"><i class="fa-solid fa-bell mr-4"></i>通知</div>
            <div class="x-sidebar-item flex items-center text-xl p-3 rounded-full cursor-pointer w-fit pr-6"><i class="fa-solid fa-user mr-4"></i>プロフィール</div>
        </nav>
        <button class="x-bg-blue text-white font-bold py-3 rounded-full w-full mt-4 hover:opacity-90">ポストする</button>
    </header>

    <main class="w-full max-w-[600px] border-r x-border">
        <div class="sticky top-0 bg-black/70 backdrop-blur-md p-4 border-b x-border z-10">
            <h2 class="text-xl font-bold">ホーム</h2>
        </div>

        <div class="p-4 border-b x-border">
            <div class="flex gap-2">
                <div class="flex-1 relative">
                    <i class="fa-solid fa-magnifying-glass absolute left-4 top-3.5 text-[#71767b]"></i>
                    <input id="searchInput" type="text" placeholder="キーワード・ユーザー名" class="bg-[#202327] rounded-full py-3 pl-12 pr-4 w-full focus:outline-none focus:ring-1 focus:ring-[#1d9bf0]">
                </div>
                <button onclick="loadTweets('user')" class="x-bg-blue text-white px-5 rounded-full font-bold">表示</button>
                <button onclick="loadTweets('search')" class="bg-white text-black px-5 rounded-full font-bold">検索</button>
            </div>
        </div>

        <div id="timeline">
            <div class="p-10 text-center text-[#71767b]">ユーザー名を入力して表示してください</div>
        </div>
    </main>

    <aside class="hidden lg:block w-80 p-4 sticky top-0 h-screen">
        <div class="bg-[#16181c] rounded-2xl p-4 x-border border">
            <h2 class="text-xl font-bold mb-4">いまどうしてる？</h2>
            <p class="text-[#71767b] text-sm">Nitter APIを利用したリアルタイム取得デモ</p>
        </div>
    </aside>

    <script>
        async function loadTweets(type) {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            const timeline = document.getElementById('timeline');
            timeline.innerHTML = '<div class="p-10 text-center"><i class="fas fa-circle-notch animate-spin x-blue text-2xl"></i></div>';

            try {
                // デプロイ後はドメインが同じになるため、相対パスで指定
                const response = await fetch(`/api/tweets?q=${encodeURIComponent(query)}&type=${type}`);
                const result = await response.json();

                timeline.innerHTML = '';
                result.data.forEach(tweet => {
                    timeline.innerHTML += `
                        <article class="p-4 border-b x-border hover:bg-[#080808] transition cursor-pointer">
                            <div class="flex gap-3">
                                <div class="w-10 h-10 bg-gray-600 rounded-full flex-shrink-0"></div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center gap-1">
                                        <span class="font-bold truncate hover:underline">${tweet.author}</span>
                                        <span class="text-[#71767b] truncate">@${tweet.username} · ${tweet.published.split(' ')[0]}</span>
                                    </div>
                                    <div class="mt-1 text-[15px] leading-relaxed break-words">${tweet.content}</div>
                                    ${tweet.image ? `<img src="${tweet.image}" class="mt-3 rounded-2xl border x-border max-h-96 w-full object-cover">` : ''}
                                    <div class="flex justify-between mt-3 text-[#71767b] max-w-sm">
                                        <span class="hover:text-blue-400"><i class="far fa-comment"></i></span>
                                        <span class="hover:text-green-400"><i class="fas fa-retweet"></i></span>
                                        <span class="hover:text-red-400"><i class="far fa-heart"></i></span>
                                        <span class="hover:text-blue-400"><i class="far fa-bookmark"></i></span>
                                    </div>
                                </div>
                            </div>
                        </article>`;
                });
            } catch (err) {
                timeline.innerHTML = `<div class="p-10 text-center text-red-500 font-bold">取得失敗。別のワードを試すか時間を置いてください。</div>`;
            }
        }
    </script>
</body>
</html>
